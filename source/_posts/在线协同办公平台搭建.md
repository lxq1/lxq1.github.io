---
layout: post
title: 在线协同办公平台搭建
categories: 
  - 软件
tags:
  - collabora office
  - onlyoffice
---




## collabora office


### 1. 拉取镜像

```

docker pull collabora/code

```
### 2. 启动镜像
容器运行命令

```
docker run -t -d -p 0.0.0.0:9980:9980 -e 'domain=pan\\.haoguangfu\\.cn' -e "username=admin" -e "password=123456" --restart always --cap-add MKNOD collabora/code


```

测试是否成功安装命令

```

https://webhttps.haoguangfu.cn/loleaflet/dist/admin/admin.html

```

Nginx配置文件

```


## collabora office

	server {
    listen       443 ssl;
    server_name  webhttps.haoguangfu.cn;

    ssl_certificate /cloud/nginx/ssl/1_webhttps.haoguangfu.cn_bundle.crt;
    ssl_certificate_key /cloud/nginx/ssl/2_webhttps.haoguangfu.cn.key;

    # static files
    location ^~ /loleaflet {
        proxy_pass https://localhost:9980;
        proxy_set_header Host $http_host;
    }

    # WOPI discovery URL
    location ^~ /hosting/discovery {
        proxy_pass https://localhost:9980;
        proxy_set_header Host $http_host;
    }

    # main websocket
    location ~ ^/lool/(.*)/ws$ {
        proxy_pass https://localhost:9980;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $http_host;
        proxy_read_timeout 36000s;
    }

    # download, presentation and image upload
    location ~ ^/lool {
        proxy_pass https://localhost:9980;
        proxy_set_header Host $http_host;
    }

    # Admin Console websocket
    location ^~ /lool/adminws {
        proxy_pass https://localhost:9980;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $http_host;
        proxy_read_timeout 36000s;
    }
	}
```
重启docker 服务

```

systemctl daemon-reload

启动Nginx

```

-----

## onlyoffice

### 1. 拉取镜像
```

docker pull onlyoffice/documentserver

```

###  2. 前期准备
```

mkdir -p /cloud/onlyoffice/DocumentServer/logs
mkdir -p /cloud/onlyoffice/DocumentServer/data
mkdir -p /cloud/onlyoffice/DocumentServer/data/certs #复制证书文件到此文件夹，证书改名onlyoffice


```
### 3. 启动容器


```

docker run -i -t -d -p 9443:443 -v /cloud/onlyoffice/DocumentServer/logs:/var/log/onlyoffice -v /cloud/onlyoffice/DocumentServer/data:/var/www/onlyoffice/Data --name onlyoffice onlyoffice/documentserver


```

### 4. docker配置文件 
```

## office
	
	  server {
        listen       443 ssl;
        server_name  webhttps.haoguangfu.cn;

        ssl on;
		ssl_certificate /cloud/nginx/ssl/1_webhttps.haoguangfu.cn_bundle.crt;
		ssl_certificate_key /cloud/nginx/ssl/2_webhttps.haoguangfu.cn.key;
		ssl_session_timeout 1d;
		ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; 
		ssl_protocols TLSv1 TLSv1.1 TLSv1.2;		
		ssl_prefer_server_ciphers on;

        location / {
           proxy_redirect off;
			proxy_pass https://localhost:9443;
			proxy_set_header Host $http_host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			 

        }
    }
```
### 4. 重启docker服务

```
systemctl daemon-reload

重启Nginx

```
### 5. 测试地址
https://服务器地址:9443/

**暂时关闭SELinux**

参考引用

> [collabora office](https://www.orgleaf.com/2280.html)

> [only office](https://www.orgleaf.com/2588.html)
